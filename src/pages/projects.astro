---
import BaseLayout from "../layouts/BaseLayout.astro";

const slugify = (v) =>
  String(v ?? "")
    .toLowerCase()
    .trim()
    .replace(/\s+/g, "-");

const asArray = (v) => (Array.isArray(v) ? v : [v]).filter(Boolean);

const projects = [
  {
    title: "Brownian Crystallisation",
    category: ["Physics", "Simulation"],
    poster: "/images/crystallisation-static.png",
    video: "/images/crystallisation.mp4",
    link: "/projects/crystallisation",
    stack: ["Python", "NumPy", "Matplotlib", "Monte Carlo"],
  },
  {
    title: "Two-Stream Instability Simulation",
    category: ["Physics", "Simulation"],
    poster: "/images/twostream-static.png",
    video: "/images/twostream.mp4",
    link: "/projects/plasma",
    stack: ["Python", "NumPy", "SciPy", "Matplotlib"],
  },
  {
    title: "Low-Temperature AFM Instrumentation",
    category: "Engineering",
    poster: "/images/afm.png",
    video: null,
    link: "/projects/afm",
    stack: [
      "AFM",
      "Cryogenics",
      "DAQ",
      "Python",
      "Open-Source Control",
      "Electromechanical Design",
    ],
  },
  {
    title: "Investigating the Gender Differences in Trust in Science",
    category: "Data Science",
    poster: "/images/gender-sentiment-wv7-static.png",
    video: "/images/trust.mp4",
    link: "/projects/trust",
    stack: ["Statistical Analysis", "Survey Data", "Python", "pandas", "Regression"],
  },
{
  title: "Global Health Sentiment Similarity",
  category: ["Data Science"],
  poster: "/images/gdelt-sentiment-static.png",
  link: "/projects/gdelt-sentiment",
  stack: ["Python", "PySpark", "MapReduce", "GDELT 2.0", "Cosine Similarity", "Matplotlib", "NLP-ish", "Distributed Computing"],
  description:
    "Distributed analysis of global health-news sentiment using GDELT. Implemented parallel MapReduce pipelines in PySpark, applied NLP-style vector similarity, and evaluated real-world scaling limits of distributed systems."
}

];
---

<BaseLayout title="Projects">
  <section class="projects-container">
    {projects.map((project) => (
      <a href={project.link} class="project-card">
        <div class="project-media">
          {project.video ? (
            <video
              class="project-video"
              src={project.video}
              poster={project.poster}
              muted
              loop
              playsinline
              preload="none"
            ></video>
          ) : (
            <img
              class="project-image"
              src={project.poster}
              alt={`${project.title} preview`}
              loading="lazy"
            />
          )}
        </div>

        <h3 class="project-title">{project.title}</h3>

        {/* Category badges (supports string or array) */}
        <div class="tag-row">
          {asArray(project.category).map((cat) => (
            <span class={`badge badge-${slugify(cat)}`}>{cat}</span>
          ))}
        </div>

        {/* Tech stack pills */}
        {project.stack?.length > 0 && (
          <div class="tag-row tag-row-tech">
            {project.stack.slice(0, 5).map((item) => (
              <span class="tag-pill">{item}</span>
            ))}
            {project.stack.length > 5 && (
              <span class="tag-pill tag-pill-muted">+ more</span>
            )}
          </div>
        )}
      </a>
    ))}
  </section>
</BaseLayout>

<script>
  document.querySelectorAll(".project-video").forEach((video) => {
    video.addEventListener("mouseenter", () => {
      video.currentTime = 0;
      video.play();
    });

    video.addEventListener("mouseleave", () => {
      video.pause();
      video.currentTime = 0;
    });
  });
</script>

<style>
  /* Keep media consistent whether it's video or image */
  .project-image {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
  }
</style>
